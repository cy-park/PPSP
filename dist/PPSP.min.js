(function(e,t){"use strict";if(typeof define==="function"&&define.amd){define(["SlideScroll","QuietWheel"],function(n,r){return e.PPSP=t(n,r)})}else if(typeof module==="object"&&module.exports){module.exports=e.PPSP=t(require("slide-scroll"),require("quietwheel"))}else{e.PPSP=t(e.SlideScroll,e.QuietWheel)}})(typeof window!=="undefined"?window:this,function(e,t){"use strict";var n;function r(r){n=this;r=r||{};n.selector=r.selector||"section";n.duration=r.duration||700;n.enableStash=r.enableStash||false;n.lockViewport=r.lockViewport||false;n.onLeave=r.onLeave;n.afterLoad=r.afterLoad;n.onStash=r.onStash;n.afterStash=r.afterStash;n.el=document.querySelectorAll(n.selector);n.currentIndex=0;n.touchThreshold=r.touchThreshold||50;n.inTransit=false;n.pauseSnap=false;n._ss=new e({duration:r.duration});n._stash_data=[];n._touch_start;n._wheel={event_arr:[],timeout_holder:null};t(p,[],function(){return a()==="in"?false:true});window.addEventListener("scroll",_);window.addEventListener("keydown",h);window.addEventListener("touchstart",v);window.addEventListener("touchmove",w);window.addEventListener("touchend",g);window.addEventListener("resize",y)}function o(e){var t=n.el[e];return t.hasAttribute("data-ppsp-skip")||window.getComputedStyle(t,null).getPropertyValue("display")==="none"?true:false}function i(e){var t=n.el[e];return t.hasAttribute("data-ppsp-stash")||n.enableStash?true:false}function a(){var e;if(n.el[0].getBoundingClientRect().top>0){e="outTop"}else{if(n.el[n.el.length-1].getBoundingClientRect().top<0)e="outBottom";else e="in"}return e}function s(e){e=e||n.currentIndex;var t=e-1;if(t>0)return o(t)?s(t):t;return 0}function l(e){e=e||n.currentIndex;var t=e+1;if(t<n.el.length-1)return o(t)?l(t):t;return n.el.length-1}function u(){var e=0,t=n.el[0].getBoundingClientRect().top;for(var r=1;r<n.el.length;r++){if(!o(r)){var i=n.el[r].getBoundingClientRect().top;if(Math.abs(t)>Math.abs(i)){e=r;t=i}else{if(o(e)){var a=s(e),u=l(e);var f=n.el[a].getBoundingClientRect().top,c=n.el[u].getBoundingClientRect().top;if(Math.abs(f)<Math.abs(c))e=a;else e=u}break}}}return e}function f(e){var t=n.currentIndex-e<0?"down":"up";var r=e;if(o(r)){r=t==="up"?s(r):l(r)}return r}function c(e,t){var n=0;var r=e.slice(Math.max(e.length-t,1));for(var o=0;o<r.length;o++){n+=Math.abs(r[o].deltaY)}return Math.ceil(n/t)}r.prototype.getPrevIndex=function(e){return s(e)};r.prototype.getNextIndex=function(e){return l(e)};r.prototype.prev=function(e,t){n.goto(s(),e,t)};r.prototype.next=function(e,t){n.goto(l(),e,t)};r.prototype.goto=function(e,t,r){if(!n.inTransit){n.inTransit=true;d(f(e),t,r)}};function d(e,t,r){if(n.currentIndex!==e){var o=n.currentIndex-e<0?"down":"up";n._ss.duration=Math.abs(n.currentIndex-e)>1?0:n.duration;var i=o==="up"?s():l();var a=window.pageYOffset+n.el[i].getBoundingClientRect().top;if(n.onLeave)n.onLeave.call(n,i,o);n._ss.to(a,function(){n.cancelStash();n.currentIndex=i;if(n.afterLoad)n.afterLoad.call(n,i,o);d(e,t,r)})}else{if(r&&r.constructor!==Array)r=[r];if(t)t.apply(null,r);n.inTransit=false}}r.prototype.snap=function(){if(!n.inTransit&&!n.pauseSnap&&n.el[n.currentIndex].getBoundingClientRect().top!==0)n.goto(u())};r.prototype.refresh=function(e){e=e||n.selector;n.el=document.querySelectorAll(e);n.snap()};r.prototype.stash=function(e,t,r){if(!n.inTransit&&n._stash_data.length===0){var o=[e,t,r];if(n._stash_data[0]!==o[0]||n._stash_data[1]!==o[1]||n._stash_data[2]!==o[2]){if(n.onStash)n.onStash.call(n,o);n._stash_data=o;if(n.afterStash)n.afterStash.call(n,o)}}};r.prototype.pop=function(){n.goto.apply(n,n._stash_data)};r.prototype.cancelStash=function(){n._stash_data=[]};function p(e){if(a()==="in"){if(i(n.currentIndex)){e.originalWheelEvent.preventDefault();if(e.direction==="up")n.stash(s());else n.stash(l())}else{if(e.direction==="up"){if(n.currentIndex>0)e.originalWheelEvent.preventDefault();n.prev()}else{if(n.currentIndex<n.el.length-1)e.originalWheelEvent.preventDefault();n.next()}}}}function h(e){if(a()==="in"){if(i(n.currentIndex)){if(e.key==="ArrowDown"){var t=l();if(n.currentIndex!==t){e.preventDefault();n.stash(l())}}else if(e.key==="ArrowUp"){var r=s();if(n.currentIndex!==r){e.preventDefault();n.stash(s())}}else if(e.key===" "){e.preventDefault();if(e.shiftKey)n.stash(s());else n.stash(l())}else{}}else{if(e.key==="ArrowDown"){n.next()}else if(e.key==="ArrowUp"){n.prev()}else if(e.key===" "){e.preventDefault();if(e.shiftKey)n.prev();else n.next()}else{}}}else{}}function v(e){n._touch_start=e.touches[0].clientY}function w(e){var t=e.touches[0].clientY;if(Math.abs(n._touch_start-t)>n.touchThreshold){if(a()==="in"){e.preventDefault();if(i(n.currentIndex)){if(n._touch_start-t<0)n.stash(s());else n.stash(l())}else{if(n._touch_start-t<0)n.prev();else n.next()}}else{}}}function g(e){}function _(e){if(n.lockViewport){window.setTimeout(n.snap,500)}else{if(!n.inTransit&&a()==="in")window.setTimeout(n.snap,500)}}function y(e){window.setTimeout(n.snap,500)}return r});