(function(e,t){"use strict";if(typeof define==="function"&&define.amd){define(["SlideScroll","QuietWheel"],function(n,i){return e.PPSP=t(n,i)})}else if(typeof module==="object"&&module.exports){module.exports=e.PPSP=t(require("slide-scroll"),require("quietwheel"))}else{e.PPSP=t(e.SlideScroll,e.QuietWheel)}})(typeof window!=="undefined"?window:this,function(e,t){"use strict";var n;function i(i){n=this;i=i||{};n.selector=i.selector||"section";n.duration=i.duration||700;n.enableStash=i.enableStash||false;n.lockViewport=i.lockViewport||false;n.onLeave=i.onLeave;n.afterLoad=i.afterLoad;n.onStash=i.onStash;n.afterStash=i.afterStash;n.el=document.querySelectorAll(n.selector);n.currentIndex=0;n.touchThreshold=i.touchThreshold||50;n.inTransit=false;n.pauseSnap=false;n._ss=new e({duration:i.duration});n._stash_data=[];n._touch_start;n._isTouchMoveInitiated=false;n._wheel={event_arr:[],timeout_holder:null};t(h,[],function(){return o()==="in"?false:true});window.addEventListener("scroll",_);window.addEventListener("keydown",p);window.addEventListener("touchstart",g);window.addEventListener("touchmove",w);window.addEventListener("touchend",v);window.addEventListener("resize",x)}function r(e){var t=n.el[e];return t.hasAttribute("data-ppsp-skip")||window.getComputedStyle(t,null).getPropertyValue("display")==="none"?true:false}function a(e){var t=n.el[e];return t.hasAttribute("data-ppsp-stash")||n.enableStash?true:false}function o(){var e;if(n.el[0].getBoundingClientRect().top>0){e="outTop"}else{if(n.el[n.el.length-1].getBoundingClientRect().top<0)e="outBottom";else e="in"}return e}function s(e){e=e||n.currentIndex;var t=e-1;if(t>0)return r(t)?s(t):t;return 0}function l(e){e=e||n.currentIndex;var t=e+1;if(t<n.el.length-1)return r(t)?l(t):t;return n.el.length-1}function u(){var e=0,t=n.el[0].getBoundingClientRect().top;for(var i=1;i<n.el.length;i++){if(!r(i)){var a=n.el[i].getBoundingClientRect().top;if(Math.abs(t)>Math.abs(a)){e=i;t=a}else{if(r(e)){var o=s(e),u=l(e);var f=n.el[o].getBoundingClientRect().top,c=n.el[u].getBoundingClientRect().top;if(Math.abs(f)<Math.abs(c))e=o;else e=u}break}}}return e}function f(e){var t=n.currentIndex-e<0?"down":"up";var i=e;if(r(i)){i=t==="up"?s(i):l(i)}return i}function c(e,t){var n=0;var i=e.slice(Math.max(e.length-t,1));for(var r=0;r<i.length;r++){n+=Math.abs(i[r].deltaY)}return Math.ceil(n/t)}i.prototype.getPrevIndex=function(e){return s(e)};i.prototype.getNextIndex=function(e){return l(e)};i.prototype.prev=function(e,t){n.goto(s(),e,t)};i.prototype.next=function(e,t){n.goto(l(),e,t)};i.prototype.goto=function(e,t,i){if(!n.inTransit){n.inTransit=true;d(f(e),t,i)}};function d(e,t,i){if(n.currentIndex!==e){var r=n.currentIndex-e<0?"down":"up";n._ss.duration=Math.abs(n.currentIndex-e)>1?0:n.duration;var a=r==="up"?s():l();var o=n.el[a].getBoundingClientRect().top;var u=window.pageYOffset+o;if(n.onLeave)n.onLeave.call(n,a,r);n._ss.to(u,function(){n.cancelStash();n.currentIndex=a;if(n.afterLoad)n.afterLoad.call(n,a,r);d(e,t,i)})}else{var r="stay";if(o<0)r="up";else if(o>0)r="down";var o=n.el[n.currentIndex].getBoundingClientRect().top;var u=window.pageYOffset+o;n._ss.to(u,function(){n.cancelStash();if(n.afterLoad)n.afterLoad.call(n,a,r);if(i&&i.constructor!==Array)i=[i];if(t)t.apply(null,i);n.inTransit=false})}}i.prototype.snap=function(){if(!n.inTransit&&!n.pauseSnap&&n.el[n.currentIndex].getBoundingClientRect().top!==0)n.goto(u())};i.prototype.refresh=function(e){e=e||n.selector;n.el=document.querySelectorAll(e);n.snap()};i.prototype.stash=function(e,t,i){if(!n.inTransit&&n._stash_data.length===0){var r=[e,t,i];if(n._stash_data[0]!==r[0]||n._stash_data[1]!==r[1]||n._stash_data[2]!==r[2]){if(n.onStash)n.onStash.call(n,r);n._stash_data=r;if(n.afterStash)n.afterStash.call(n,r)}}};i.prototype.pop=function(){n.goto.apply(n,n._stash_data)};i.prototype.cancelStash=function(){n._stash_data=[]};function h(e){if(o()==="in"){e.originalWheelEvent.preventDefault();if(a(n.currentIndex)){if(e.direction==="up"){if(n.currentIndex===0){if(!n.inTransit){n.inTransit=true;n._ss.to(Math.max(window.pageYOffset-window.innerHeight,0),function(){n.inTransit=false})}}else{n.stash(s())}}else{if(n.currentIndex===n.el.length-1){if(!n.inTransit){n.inTransit=true;n._ss.to(window.pageYOffset+window.innerHeight,function(){n.inTransit=false})}}else{n.stash(l())}}}else{if(e.direction==="up"){if(n.currentIndex===0){if(!n.inTransit){n.inTransit=true;n._ss.to(Math.max(window.pageYOffset-window.innerHeight,0),function(){n.inTransit=false})}}else{n.prev()}}else{if(n.currentIndex===n.el.length-1){if(!n.inTransit){n.inTransit=true;n._ss.to(window.pageYOffset+window.innerHeight,function(){n.inTransit=false})}}else{n.next()}}}}else{if(n.currentIndex===0&&n.el[0].getBoundingClientRect().top<0||n.currentIndex===n.el.length-1&&n.el[n.el.length-1].getBoundingClientRect().top>0)e.originalWheelEvent.preventDefault()}}function p(e){if(o()==="in"){if(a(n.currentIndex)){if(e.key==="ArrowDown"){var t=l();if(n.currentIndex!==t){e.preventDefault();n.stash(l())}}else if(e.key==="ArrowUp"){var i=s();if(n.currentIndex!==i){e.preventDefault();n.stash(s())}}else if(e.key===" "){e.preventDefault();if(e.shiftKey)n.stash(s());else n.stash(l())}else{}}else{if(e.key==="ArrowDown"){n.next()}else if(e.key==="ArrowUp"){n.prev()}else if(e.key===" "){e.preventDefault();if(e.shiftKey)n.prev();else n.next()}else{}}}else{}}function g(e){if(o()==="in"){e.preventDefault()}else{if(n.currentIndex===0&&n.el[0].getBoundingClientRect().top<0||n.currentIndex===n.el.length-1&&n.el[n.el.length-1].getBoundingClientRect().top>0)e.preventDefault()}n._touch_start=e.touches[0].clientY;n._isTouchMoveInitiated=false}function w(e){var t=e.touches[0].clientY;if(Math.abs(n._touch_start-t)>n.touchThreshold){if(o()==="in"){e.preventDefault();if(!n._isTouchMoveInitiated){n._isTouchMoveInitiated=true;if(a(n.currentIndex)){if(n._touch_start-t<0){if(n.currentIndex===0){if(!n.inTransit){n.inTransit=true;n._ss.to(Math.max(window.pageYOffset-window.innerHeight,0),function(){n.inTransit=false})}}else{n.stash(s())}}else{if(n.currentIndex===n.el.length-1){if(!n.inTransit){n.inTransit=true;n._ss.to(window.pageYOffset+window.innerHeight,function(){n.inTransit=false})}}else{n.stash(l())}}}else{if(n._touch_start-t<0){if(n.currentIndex===0){if(!n.inTransit){n.inTransit=true;n._ss.to(Math.max(window.pageYOffset-window.innerHeight,0),function(){n.inTransit=false})}}else{n.prev()}}else{if(n.currentIndex===n.el.length-1){if(!n.inTransit){n.inTransit=true;n._ss.to(window.pageYOffset+window.innerHeight,function(){n.inTransit=false})}}else{n.next()}}}}}else{if(n.currentIndex===0&&n.el[0].getBoundingClientRect().top<0||n.currentIndex===n.el.length-1&&n.el[n.el.length-1].getBoundingClientRect().top>0)e.preventDefault()}}}function v(e){}function _(e){window.setTimeout(function(){if(n.lockViewport){n.snap()}else{if(!n.inTransit&&o()==="in")n.snap()}},500)}function x(e){window.setTimeout(n.snap,500)}return i});